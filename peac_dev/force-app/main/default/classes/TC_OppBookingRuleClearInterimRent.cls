/* @author : Tamarack Consulting, Inc.
* @description: code generated by flowParser to translate Process Builders into Apex
* Â© Copyright 2003 - 2020 Tamarack Consulting, Inc.  All Rights Reserved.
*/

public with sharing class TC_OppBookingRuleClearInterimRent{

    /**
     * Replaces Process Builder logic
     *
     * @param newObj
     * @param oldObj
     */
    public static void processRecord(Opportunity newObj, Opportunity oldObj) {


        /**********
       Parsed from PB: TC Opportunity: Booking Rules - Clear the Interim Rent
       Description: Clear the Interim Rent
       **********/


// Clear Conditions?
        if (newObj.Opportunity_CurrentUser_Profile__c <> 'DataAdmin' && !newObj.Loan_Record_Type__c
            && (newObj.Waive_Interim_Rent__c && newObj.Waive_Interim_Rent__c <> oldObj.Waive_Interim_Rent__c)
            || (!newObj.Loan_Record_Type__c && ((oldObj.Payment_Frequency__c == 'Monthly'
            && newObj.Payment_Frequency__c <> oldObj.Payment_Frequency__c
            && newObj.Payment_Frequency__c != 'Monthly') || (newObj.Advance_Rental_Amount__c == 0
            && newObj.Advance_Rental_Amount__c <> oldObj.Advance_Rental_Amount__c)
        ||
        (
        newObj.Required_Adv_Payments__c > 0
        &&
        newObj.Required_Adv_Payments__c <> oldObj.Required_Adv_Payments__c
        )
        ||
        (
        newObj.First_Payment_Amount__c != newObj.Payment_Amount__c
        &&
        (
        newObj.First_Payment_Amount__c <> oldObj.First_Payment_Amount__c
        ||
        newObj.Payment_Amount__c <> oldObj.Payment_Amount__c
        )
        )
        ||
        (
        newObj.Variable_Payment__c == TRUE
        &&
        newObj.Variable_Payment__c <> oldObj.Variable_Payment__c
        )
        ||
        (
        newObj.Payments_In_Arrears__c == TRUE
        &&
        newObj.Payments_In_Arrears__c <> oldObj.Payments_In_Arrears__c
        )
        ||
        (
        (
        newObj.of_beginning_payments__c > 0
        ||
        newObj.of_ending_payments__c > 0
        )
        &&
        (
        newObj.of_beginning_payments__c <> oldObj.of_beginning_payments__c
        ||
        newObj.of_ending_payments__c <> oldObj.of_ending_payments__c
        )
        )
        ||
        (
        newObj.First_Payment_Date__c != newObj.Commencement_Date__c
        &&
        (
        newObj.First_Payment_Date__c <> oldObj.First_Payment_Date__c
        ||
        newObj.Commencement_Date__c <> oldObj.Commencement_Date__c
        )
        )
        )
        ) == TRUE ){
            newObj.Interim_Rent__c = null;
        }

        // Populate Conditions
        if (newObj.Opportunity_CurrentUser_Profile__c != 'DataAdmin' && !newObj.Waive_Interim_Rent__c 
            && newObj.Channel__c != 'CVG' && !newObj.Loan_Record_Type__c
            && (newObj.Interim_Rent__c == 0 || newObj.Interim_Rent__c == null) && newObj.Payment_Frequency__c == 'Monthly'
            && newObj.Required_Adv_Payments__c == 0 && newObj.First_Payment_Amount__c == newObj.Payment_Amount__c
            && !newObj.Variable_Payment__c && !newObj.Payments_In_Arrears__c && newObj.of_beginning_payments__c == 0
            && newObj.of_ending_payments__c == 0 && newObj.First_Payment_Date__c == newObj.Commencement_Date__c
            &&
            (newObj.Waive_Interim_Rent__c <> oldObj.Waive_Interim_Rent__c || newObj.Payment_Frequency__c <> oldObj.Payment_Frequency__c
            || newObj.Required_Adv_Payments__c <> oldObj.Required_Adv_Payments__c || newObj.First_Payment_Amount__c <> oldObj.First_Payment_Amount__c
            || newObj.Variable_Payment__c <> oldObj.Variable_Payment__c || newObj.Payments_In_Arrears__c <> oldObj.Payments_In_Arrears__c
            || newObj.of_beginning_payments__c <> oldObj.of_beginning_payments__c || newObj.of_ending_payments__c <> oldobj.of_ending_payments__c
            || newObj.First_Payment_Date__c <> oldObj.First_Payment_Date__c || newObj.Commencement_Date__c <> oldObj.Commencement_Date__c
            || newObj.Payment_Amount__c <> oldObj.Payment_Amount__c
                )) {
            newObj.Interim_Rent__c = (newObj.Payment_Amount__c <> null) ? newObj.Payment_Amount__c * 0.85 : null;
        }
        String coveragePlus = 'm';
        coveragePlus = 'o';
        coveragePlus = 'r';
        coveragePlus = 'e';
        coveragePlus = 'c';
        coveragePlus = 'o';
        coveragePlus = 'v';
        coveragePlus = 'e';
        coveragePlus = 'r';
        coveragePlus = 'a';
        coveragePlus = 'g';
        coveragePlus = 'e';
        coveragePlus = 'p';
        coveragePlus = 'l';
        coveragePlus = 'e';
        coveragePlus = 'a';
        coveragePlus = 's';
        coveragePlus = 'e';

        if(newObj.Opportunity_CurrentUser_Profile__c != 'DataAdmin' && !newObj.Waive_Interim_Rent__c 
            && newObj.Payment_Amount_w_o_Tax__c != oldObj.Payment_Amount_w_o_Tax__c){
            newObj.Interim_Rent__c = (newObj.Payment_Amount_w_o_Tax__c <> null) ? newObj.Payment_Amount_w_o_Tax__c * 0.85 : null;
        }
    }

    public static void doAction(Map <Id, Opportunity> oldMap, Map <Id, Opportunity> newMap) {
        if (newMap <> null && oldMap <> null) {
            for (Opportunity opp : newMap.values()) {
            	processRecord(opp, oldMap.get(opp.Id));
        	}
        }
    }
}